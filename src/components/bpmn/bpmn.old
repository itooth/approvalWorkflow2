<template>
  <div id="container"></div>
  <div class="btns">
    <a-space>
      <a-button type="primary" @click="save()">保存</a-button>
    </a-space>
  </div>
</template>

<script setup>
import { reactive, ref, onMounted, markRaw } from "vue";
import "bpmn-js/dist/assets/diagram-js.css";
import "bpmn-js/dist/assets/bpmn-font/css/bpmn-embedded.css";
import BpmnModeler from "bpmn-js/lib/Modeler";

// import 'bpmn-js-properties-panel/dist/assets/bpmn-js-properties-panel.css'
// import propertiesPanelModule from 'bpmn-js-properties-panel'
// import propertiesProviderModule from 'bpmn-js-properties-panel/lib/provider/camunda'
// import camundaModdleDescriptor from 'camunda-bpmn-moddle/resources/camunda'

const data = reactive({
  containerEl: null,
  bpmnModeler: null,
});

function init() {
  data.containerEl = document.getElementById("container");
  // 加markRaw去除双向绑定作用域
  data.bpmnModeler = markRaw(
    new BpmnModeler({
      container: data.containerEl,
    })
  );
  // data.bpmnModeler.createDiagram(() => {
  //   data.bpmnModeler.get('canvas').zoom('fit-viewport');
  // });
  data.bpmnModeler.createDiagram().then((result) => {
    data.bpmnModeler.get("canvas").zoom("fit-viewport");
    console.log(result);
  });
}

async function save() {
  // data.bpmnModeler.saveXML({ format: true }, (err, data) => {
  //   // let xml = data.replace(/camunda.org\/schema\/1.0\/bpmn/ig, "activiti.org/bpmn").replace(/camunda/ig, "activiti");
  //   console.log(data);
  // });

  let options = { format: true };
  const result = await data.bpmnModeler.saveXML(options);
  const { xml } = result;
  console.log(xml);
}

onMounted(() => {
  init();
});
</script>

<style>
#container {
  width: 100%;
  height: calc(500px);
  border: 1px solid #a3a3ff;
  overflow: scroll;
}
</style>
